import{g as an,r as on,h as _t,a as we,A as _,_ as I,W as F,T as fe,b as f,w as C,S as St,d as cn,c as He,B as Je,e as $e,f as P,i as E,j as u,k as Lt,u as se,l as Mt,m as Re,n as Ft,o as Ze,p as ln,q as B,s as Xe,t as K,v as hn,x as un,y as dn,z as Tt,C as Nt,D as pn,E as gn,F as wn,G as fn,H as j,I as mn,J as yn,K as vn,L as In,M as En,N as bn,O as Cn,P as An,Q as _n,R as Sn,U as Ln,V as Mn,X as Fn,Y as Tn,Z as Nn,$ as Dn,a0 as On,a1 as Pn,a2 as xn,a3 as jn,a4 as Rn,a5 as Wn,a6 as Un,a7 as qn}from"./index.f777a6be.js";import{c as te,N as Dt,$ as Ae,V as et,q as zn,f as kn,i as $n,a as Bn,b as Ot,D as Gn,d as Qn,e as Kn,g as Vn,h as pe,j as Yn,Z as Hn,s as Jn,_ as Zn,k as Xn,l as ae,m as ei}from"./index.es.9cbfc799.js";import{e as ti}from"./index.33ea6e67.js";import{W as ni,A as ii,C as ri,P as si,S as ai,U as oi}from"./errors-3055a99c.browser.esm.77830c12.js";import{n as ci}from"./normalizeChainId-e4cc0175.browser.esm.042707b7.js";import{E as li}from"./constants-1ba9df2b.browser.esm.1400d5f9.js";function hi(n,e){return e=e||{},new Promise(function(t,i){var r=new XMLHttpRequest,s=[],a=[],o={},c=function(){return{ok:(r.status/100|0)==2,statusText:r.statusText,status:r.status,url:r.responseURL,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(r.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([r.response]))},clone:c,headers:{keys:function(){return s},entries:function(){return a},get:function(h){return o[h.toLowerCase()]},has:function(h){return h.toLowerCase()in o}}}};for(var l in r.open(e.method||"get",n,!0),r.onload=function(){r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(h,p,w){s.push(p=p.toLowerCase()),a.push([p,w]),o[p]=o[p]?o[p]+","+w:w}),t(c())},r.onerror=i,r.withCredentials=e.credentials=="include",e.headers)r.setRequestHeader(l,e.headers[l]);r.send(e.body||null)})}const ui=Object.freeze(Object.defineProperty({__proto__:null,default:hi},Symbol.toStringTag,{value:"Module"})),tt=an(ui);var di=self.fetch||(self.fetch=tt.default||tt);class pi{constructor(e){this.client=e}}class gi{constructor(e){this.opts=e}}const wi="https://rpc.walletconnect.com/v1",ne={wc_authRequest:{req:{ttl:pe.ONE_DAY,prompt:!0,tag:3e3},res:{ttl:pe.ONE_DAY,prompt:!1,tag:3001}}},_e={min:pe.FIVE_MINUTES,max:pe.SEVEN_DAYS},Pt="wc",fi=1,mi="auth",nt="authClient",oe=`${Pt}@${1}:${mi}:`,G=`${oe}:PUB_KEY`;function Be(n){return n==null?void 0:n.split(":")}function yi(n){const e=n&&Be(n);if(e)return e[3]}function vi(n){const e=n&&Be(n);if(e)return e[2]+":"+e[3]}function it(n){const e=n&&Be(n);if(e)return e.pop()}async function Ii(n,e,t,i,r){switch(t.t){case"eip191":return Ei(n,e,t.s);case"eip1271":return await bi(n,e,t.s,i,r);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}function Ei(n,e,t){return on(_t(e),t).toLowerCase()===n.toLowerCase()}async function bi(n,e,t,i,r){try{const s="0x1626ba7e",a="0000000000000000000000000000000000000000000000000000000000000040",o="0000000000000000000000000000000000000000000000000000000000000041",c=t.substring(2),l=_t(e).substring(2),h=s+l+a+o+c,p=await di(`${wi}/?chainId=${i}&projectId=${r}`,{method:"POST",body:JSON.stringify({id:Ci(),jsonrpc:"2.0",method:"eth_call",params:[{to:n,data:h},"latest"]})}),{result:w}=await p.json();return w?w.slice(0,s.length).toLowerCase()===s.toLowerCase():!1}catch(s){return console.error("isValidEip1271Signature: ",s),!1}}function Ci(){return Date.now()+Math.floor(Math.random()*1e3)}function xt(n){return n.getAll().filter(e=>"requester"in e)}function jt(n,e){return xt(n).find(t=>t.id===e)}function Ai(n){const e=Yn(n.aud),t=new RegExp(`${n.domain}`).test(n.aud),i=!!n.nonce,r=n.type?n.type==="eip4361":!0,s=n.expiry;if(s&&!Hn(s,_e)){const{message:a}=Ot("MISSING_OR_INVALID",`request() expiry: ${s}. Expiry must be a number (in seconds) between ${_e.min} and ${_e.max}`);throw new Error(a)}return!!(e&&t&&i&&r)}function _i(n,e){return!!jt(e,n.id)}function Si(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(n):new Uint8Array(n)}function Li(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var r=0;r<n.length;r++){var s=n.charAt(r),a=s.charCodeAt(0);if(t[a]!==255)throw new TypeError(s+" is ambiguous");t[a]=r}var o=n.length,c=n.charAt(0),l=Math.log(o)/Math.log(256),h=Math.log(256)/Math.log(o);function p(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,S=0,b=0,N=d.length;b!==N&&d[b]===0;)b++,m++;for(var D=(N-b)*h+1>>>0,A=new Uint8Array(D);b!==N;){for(var O=d[b],R=0,L=D-1;(O!==0||R<S)&&L!==-1;L--,R++)O+=256*A[L]>>>0,A[L]=O%o>>>0,O=O/o>>>0;if(O!==0)throw new Error("Non-zero carry");S=R,b++}for(var x=D-S;x!==D&&A[x]===0;)x++;for(var ee=c.repeat(m);x<D;++x)ee+=n.charAt(A[x]);return ee}function w(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var S=0,b=0;d[m]===c;)S++,m++;for(var N=(d.length-m)*l+1>>>0,D=new Uint8Array(N);d[m];){var A=t[d.charCodeAt(m)];if(A===255)return;for(var O=0,R=N-1;(A!==0||O<b)&&R!==-1;R--,O++)A+=o*D[R]>>>0,D[R]=A%256>>>0,A=A/256>>>0;if(A!==0)throw new Error("Non-zero carry");b=O,m++}if(d[m]!==" "){for(var L=N-b;L!==N&&D[L]===0;)L++;for(var x=new Uint8Array(S+(N-L)),ee=S;L!==N;)x[ee++]=D[L++];return x}}}function T(d){var m=w(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:p,decodeUnsafe:w,decode:T}}var Mi=Li,Fi=Mi;const Rt=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},Ti=n=>new TextEncoder().encode(n),Ni=n=>new TextDecoder().decode(n);class Di{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Oi{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Wt(this,e)}}class Pi{constructor(e){this.decoders=e}or(e){return Wt(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Wt=(n,e)=>new Pi({...n.decoders||{[n.prefix]:n},...e.decoders||{[e.prefix]:e}});class xi{constructor(e,t,i,r){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=r,this.encoder=new Di(e,t,i),this.decoder=new Oi(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const me=({name:n,prefix:e,encode:t,decode:i})=>new xi(n,e,t,i),V=({prefix:n,name:e,alphabet:t})=>{const{encode:i,decode:r}=Fi(t,e);return me({prefix:n,name:e,encode:i,decode:s=>Rt(r(s))})},ji=(n,e,t,i)=>{const r={};for(let h=0;h<e.length;++h)r[e[h]]=h;let s=n.length;for(;n[s-1]==="=";)--s;const a=new Uint8Array(s*t/8|0);let o=0,c=0,l=0;for(let h=0;h<s;++h){const p=r[n[h]];if(p===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|p,o+=t,o>=8&&(o-=8,a[l++]=255&c>>o)}if(o>=t||255&c<<8-o)throw new SyntaxError("Unexpected end of data");return a},Ri=(n,e,t)=>{const i=e[e.length-1]==="=",r=(1<<t)-1;let s="",a=0,o=0;for(let c=0;c<n.length;++c)for(o=o<<8|n[c],a+=8;a>t;)a-=t,s+=e[r&o>>a];if(a&&(s+=e[r&o<<t-a]),i)for(;s.length*t&7;)s+="=";return s},v=({name:n,prefix:e,bitsPerChar:t,alphabet:i})=>me({prefix:e,name:n,encode(r){return Ri(r,i,t)},decode(r){return ji(r,i,t,n)}}),Wi=me({prefix:"\0",name:"identity",encode:n=>Ni(n),decode:n=>Ti(n)});var Ui=Object.freeze({__proto__:null,identity:Wi});const qi=v({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var zi=Object.freeze({__proto__:null,base2:qi});const ki=v({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var $i=Object.freeze({__proto__:null,base8:ki});const Bi=V({prefix:"9",name:"base10",alphabet:"0123456789"});var Gi=Object.freeze({__proto__:null,base10:Bi});const Qi=v({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ki=v({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Vi=Object.freeze({__proto__:null,base16:Qi,base16upper:Ki});const Yi=v({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Hi=v({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ji=v({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Zi=v({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Xi=v({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),er=v({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),tr=v({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),nr=v({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ir=v({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var rr=Object.freeze({__proto__:null,base32:Yi,base32upper:Hi,base32pad:Ji,base32padupper:Zi,base32hex:Xi,base32hexupper:er,base32hexpad:tr,base32hexpadupper:nr,base32z:ir});const sr=V({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ar=V({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var or=Object.freeze({__proto__:null,base36:sr,base36upper:ar});const cr=V({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),lr=V({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var hr=Object.freeze({__proto__:null,base58btc:cr,base58flickr:lr});const ur=v({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),dr=v({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),pr=v({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),gr=v({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var wr=Object.freeze({__proto__:null,base64:ur,base64pad:dr,base64url:pr,base64urlpad:gr});const Ut=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),fr=Ut.reduce((n,e,t)=>(n[t]=e,n),[]),mr=Ut.reduce((n,e,t)=>(n[e.codePointAt(0)]=t,n),[]);function yr(n){return n.reduce((e,t)=>(e+=fr[t],e),"")}function vr(n){const e=[];for(const t of n){const i=mr[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const Ir=me({prefix:"\u{1F680}",name:"base256emoji",encode:yr,decode:vr});var Er=Object.freeze({__proto__:null,base256emoji:Ir}),br=qt,rt=128,Cr=127,Ar=~Cr,_r=Math.pow(2,31);function qt(n,e,t){e=e||[],t=t||0;for(var i=t;n>=_r;)e[t++]=n&255|rt,n/=128;for(;n&Ar;)e[t++]=n&255|rt,n>>>=7;return e[t]=n|0,qt.bytes=t-i+1,e}var Sr=We,Lr=128,st=127;function We(n,i){var t=0,i=i||0,r=0,s=i,a,o=n.length;do{if(s>=o)throw We.bytes=0,new RangeError("Could not decode varint");a=n[s++],t+=r<28?(a&st)<<r:(a&st)*Math.pow(2,r),r+=7}while(a>=Lr);return We.bytes=s-i,t}var Mr=Math.pow(2,7),Fr=Math.pow(2,14),Tr=Math.pow(2,21),Nr=Math.pow(2,28),Dr=Math.pow(2,35),Or=Math.pow(2,42),Pr=Math.pow(2,49),xr=Math.pow(2,56),jr=Math.pow(2,63),Rr=function(n){return n<Mr?1:n<Fr?2:n<Tr?3:n<Nr?4:n<Dr?5:n<Or?6:n<Pr?7:n<xr?8:n<jr?9:10},Wr={encode:br,decode:Sr,encodingLength:Rr},zt=Wr;const at=(n,e,t=0)=>(zt.encode(n,e,t),e),ot=n=>zt.encodingLength(n),Ue=(n,e)=>{const t=e.byteLength,i=ot(n),r=i+ot(t),s=new Uint8Array(r+t);return at(n,s,0),at(t,s,i),s.set(e,r),new Ur(n,t,e,s)};class Ur{constructor(e,t,i,r){this.code=e,this.size=t,this.digest=i,this.bytes=r}}const kt=({name:n,code:e,encode:t})=>new qr(n,e,t);class qr{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ue(this.code,t):t.then(i=>Ue(this.code,i))}else throw Error("Unknown type, must be binary type")}}const $t=n=>async e=>new Uint8Array(await crypto.subtle.digest(n,e)),zr=kt({name:"sha2-256",code:18,encode:$t("SHA-256")}),kr=kt({name:"sha2-512",code:19,encode:$t("SHA-512")});var $r=Object.freeze({__proto__:null,sha256:zr,sha512:kr});const Bt=0,Br="identity",Gt=Rt,Gr=n=>Ue(Bt,Gt(n)),Qr={code:Bt,name:Br,encode:Gt,digest:Gr};var Kr=Object.freeze({__proto__:null,identity:Qr});new TextEncoder,new TextDecoder;const ct={...Ui,...zi,...$i,...Gi,...Vi,...rr,...or,...hr,...wr,...Er};({...$r,...Kr});function Qt(n,e,t,i){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:i}}}const lt=Qt("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),Se=Qt("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=Si(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),Kt={utf8:lt,"utf-8":lt,hex:ct.base16,latin1:Se,ascii:Se,binary:Se,...ct};function Vr(n,e="utf8"){const t=Kt[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n,"utf8"):t.decoder.decode(`${t.prefix}${n}`)}function Yr(n,e="utf8"){const t=Kt[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n.buffer,n.byteOffset,n.byteLength).toString("utf8"):t.encoder.encode(n).substring(1)}const Hr="base16",Jr="utf8";function ht(n){const e=Jn.hash(Vr(n,Jr));return Yr(e,Hr)}var Zr=Object.defineProperty,Xr=Object.defineProperties,es=Object.getOwnPropertyDescriptors,ut=Object.getOwnPropertySymbols,ts=Object.prototype.hasOwnProperty,ns=Object.prototype.propertyIsEnumerable,dt=(n,e,t)=>e in n?Zr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$=(n,e)=>{for(var t in e||(e={}))ts.call(e,t)&&dt(n,t,e[t]);if(ut)for(var t of ut(e))ns.call(e,t)&&dt(n,t,e[t]);return n},Le=(n,e)=>Xr(n,es(e));class is extends pi{constructor(e){super(e),this.initialized=!1,this.name="authEngine",this.init=()=>{this.initialized||(this.registerRelayerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(ne)}),this.initialized=!0)},this.request=async(t,i)=>{if(this.isInitialized(),!Ai(t))throw new Error("Invalid request");if(i!=null&&i.topic)return await this.requestOnKnownPairing(i.topic,t);const{chainId:r,statement:s,aud:a,domain:o,nonce:c,type:l,exp:h,nbf:p}=t,{topic:w,uri:T}=await this.client.core.pairing.create();this.client.logger.info({message:"Generated new pairing",pairing:{topic:w,uri:T}});const d=await this.client.core.crypto.generateKeyPair(),m=et(d);await this.client.authKeys.set(G,{responseTopic:m,publicKey:d}),await this.client.pairingTopics.set(m,{topic:m,pairingTopic:w}),await this.client.core.relayer.subscribe(m),this.client.logger.info(`sending request to new pairing topic: ${w}`);const S=await this.sendRequest(w,"wc_authRequest",{payloadParams:{type:l!=null?l:"eip4361",chainId:r,statement:s,aud:a,domain:o,version:"1",nonce:c,iat:new Date().toISOString(),exp:h,nbf:p},requester:{publicKey:d,metadata:this.client.metadata}},{},t.expiry);return this.client.logger.info(`sent request to new pairing topic: ${w}`),{uri:T,id:S}},this.respond=async(t,i)=>{if(this.isInitialized(),!_i(t,this.client.requests))throw new Error("Invalid response");const r=jt(this.client.requests,t.id);if(!r)throw new Error(`Could not find pending auth request with id ${t.id}`);const s=r.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),o=et(s),c={type:Zn,receiverPublicKey:s,senderPublicKey:a};if("error"in t){await this.sendError(r.id,o,t,c);return}const l={h:{t:"eip4361"},p:Le($({},r.cacaoPayload),{iss:i}),s:t.signature};await this.sendResult(r.id,o,l,c),await this.client.core.pairing.activate({topic:r.pairingTopic}),await this.client.requests.update(r.id,$({},l))},this.getPendingRequests=()=>xt(this.client.requests),this.formatMessage=(t,i)=>{this.client.logger.debug(`formatMessage, cacao is: ${JSON.stringify(t)}`);const r=`${t.domain} wants you to sign in with your Ethereum account:`,s=it(i),a=t.statement,o=`URI: ${t.aud}`,c=`Version: ${t.version}`,l=`Chain ID: ${yi(i)}`,h=`Nonce: ${t.nonce}`,p=`Issued At: ${t.iat}`,w=t.exp?`Expiry: ${t.exp}`:void 0,T=t.resources&&t.resources.length>0?`Resources:
${t.resources.map(d=>`- ${d}`).join(`
`)}`:void 0;return[r,s,"",a,"",o,c,l,h,p,w,T].filter(d=>d!=null).join(`
`)},this.setExpiry=async(t,i)=>{this.client.core.pairing.pairings.keys.includes(t)&&await this.client.core.pairing.updateExpiry({topic:t,expiry:i}),this.client.core.expirer.set(t,i)},this.sendRequest=async(t,i,r,s,a)=>{const o=Xn(i,r),c=await this.client.core.crypto.encode(t,o,s),l=ne[i].req;if(a&&(l.ttl=a),this.client.core.history.set(t,o),zn()){const h=ht(JSON.stringify(o));this.client.core.verify.register({attestationId:h})}return await this.client.core.relayer.publish(t,c,Le($({},l),{internal:{throwOnFailedPublish:!0}})),o.id},this.sendResult=async(t,i,r,s)=>{const a=ae(t,r),o=await this.client.core.crypto.encode(i,a,s),c=await this.client.core.history.get(i,t),l=ne[c.request.method].res;return await this.client.core.relayer.publish(i,o,Le($({},l),{internal:{throwOnFailedPublish:!0}})),await this.client.core.history.resolve(a),a.id},this.sendError=async(t,i,r,s)=>{const a=kn(t,r.error),o=await this.client.core.crypto.encode(i,a,s),c=await this.client.core.history.get(i,t),l=ne[c.request.method].res;return await this.client.core.relayer.publish(i,o,l),await this.client.core.history.resolve(a),a.id},this.requestOnKnownPairing=async(t,i)=>{const r=this.client.core.pairing.pairings.getAll({active:!0}).find(T=>T.topic===t);if(!r)throw new Error(`Could not find pairing for provided topic ${t}`);const{publicKey:s}=this.client.authKeys.get(G),{chainId:a,statement:o,aud:c,domain:l,nonce:h,type:p}=i,w=await this.sendRequest(r.topic,"wc_authRequest",{payloadParams:{type:p!=null?p:"eip4361",chainId:a,statement:o,aud:c,domain:l,version:"1",nonce:h,iat:new Date().toISOString()},requester:{publicKey:s,metadata:this.client.metadata}},{},i.expiry);return this.client.logger.info(`sent request to known pairing topic: ${r.topic}`),{id:w}},this.onPairingCreated=t=>{const i=this.getPendingRequests();if(i){const r=Object.values(i).find(s=>s.pairingTopic===t.topic);r&&this.handleAuthRequest(r)}},this.onRelayEventRequest=t=>{const{topic:i,payload:r}=t,s=r.method;switch(s){case"wc_authRequest":return this.onAuthRequest(i,r);default:return this.client.logger.info(`Unsupported request method ${s}`)}},this.onRelayEventResponse=async t=>{const{topic:i,payload:r}=t,s=(await this.client.core.history.get(i,r.id)).request.method;switch(s){case"wc_authRequest":return this.onAuthResponse(i,r);default:return this.client.logger.info(`Unsupported response method ${s}`)}},this.onAuthRequest=async(t,i)=>{const{requester:r,payloadParams:s}=i.params;this.client.logger.info({type:"onAuthRequest",topic:t,payload:i});const a=ht(JSON.stringify(i)),o=await this.getVerifyContext(a,this.client.metadata),c={requester:r,pairingTopic:t,id:i.id,cacaoPayload:s,verifyContext:o};await this.client.requests.set(i.id,c),this.handleAuthRequest(c)},this.handleAuthRequest=async t=>{const{id:i,pairingTopic:r,requester:s,cacaoPayload:a,verifyContext:o}=t;try{this.client.emit("auth_request",{id:i,topic:r,params:{requester:s,cacaoPayload:a},verifyContext:o})}catch(c){await this.sendError(t.id,t.pairingTopic,c),this.client.logger.error(c)}},this.onAuthResponse=async(t,i)=>{const{id:r}=i;if(this.client.logger.info({type:"onAuthResponse",topic:t,response:i}),$n(i)){const{pairingTopic:s}=this.client.pairingTopics.get(t);await this.client.core.pairing.activate({topic:s});const{s:a,p:o}=i.result;await this.client.requests.set(r,$({id:r,pairingTopic:s},i.result));const c=this.formatMessage(o,o.iss);this.client.logger.debug(`reconstructed message:
`,JSON.stringify(c)),this.client.logger.debug("payload.iss:",o.iss),this.client.logger.debug("signature:",a);const l=it(o.iss),h=vi(o.iss);if(!l)throw new Error("Could not derive address from `payload.iss`");if(!h)throw new Error("Could not derive chainId from `payload.iss`");this.client.logger.debug("walletAddress extracted from `payload.iss`:",l),await Ii(l,c,a,h,this.client.projectId)?this.client.emit("auth_response",{id:r,topic:t,params:i}):this.client.emit("auth_response",{id:r,topic:t,params:{message:"Invalid signature",code:-1}})}else Bn(i)&&this.client.emit("auth_response",{id:r,topic:t,params:i})},this.getVerifyContext=async(t,i)=>{const r={verified:{verifyUrl:i.verifyUrl||"",validation:"UNKNOWN",origin:i.url||""}};try{const s=await this.client.core.verify.resolve({attestationId:t,verifyUrl:i.verifyUrl});s&&(r.verified.origin=s.origin,r.verified.isScam=s.isScam,r.verified.validation=origin===new URL(i.url).origin?"VALID":"INVALID")}catch(s){this.client.logger.error(s)}return this.client.logger.info(`Verify context: ${JSON.stringify(r)}`),r}}isInitialized(){if(!this.initialized){const{message:e}=Ot("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(Gn.message,async e=>{const{topic:t,message:i}=e,{responseTopic:r,publicKey:s}=this.client.authKeys.keys.includes(G)?this.client.authKeys.get(G):{responseTopic:void 0,publicKey:void 0};if(r&&t!==r){this.client.logger.debug("[Auth] Ignoring message from unknown topic",t);return}const a=await this.client.core.crypto.decode(t,i,{receiverPublicKey:s});Qn(a)?(this.client.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):Kn(a)&&(await this.client.core.history.resolve(a),this.onRelayEventResponse({topic:t,payload:a}))})}registerPairingEvents(){this.client.core.pairing.events.on(Vn.create,e=>this.onPairingCreated(e))}}class Ge extends gi{constructor(e){super(e),this.protocol=Pt,this.version=fi,this.name=nt,this.events=new ti.exports.EventEmitter,this.emit=(i,r)=>this.events.emit(i,r),this.on=(i,r)=>this.events.on(i,r),this.once=(i,r)=>this.events.once(i,r),this.off=(i,r)=>this.events.off(i,r),this.removeListener=(i,r)=>this.events.removeListener(i,r),this.request=async(i,r)=>{try{return await this.engine.request(i,r)}catch(s){throw this.logger.error(s.message),s}},this.respond=async(i,r)=>{try{return await this.engine.respond(i,r)}catch(s){throw this.logger.error(s.message),s}},this.getPendingRequests=()=>{try{return this.engine.getPendingRequests()}catch(i){throw this.logger.error(i.message),i}},this.formatMessage=(i,r)=>{try{return this.engine.formatMessage(i,r)}catch(s){throw this.logger.error(s.message),s}};const t=typeof e.logger<"u"&&typeof e.logger!="string"?e.logger:te.pino(te.getDefaultLoggerOptions({level:e.logger||"error"}));this.name=(e==null?void 0:e.name)||nt,this.metadata=e.metadata,this.projectId=e.projectId,this.core=e.core||new Dt(e),this.logger=te.generateChildLogger(t,this.name),this.authKeys=new Ae(this.core,this.logger,"authKeys",oe,()=>G),this.pairingTopics=new Ae(this.core,this.logger,"pairingTopics",oe),this.requests=new Ae(this.core,this.logger,"requests",oe,i=>i.id),this.engine=new is(this)}static async init(e){const t=new Ge(e);return await t.initialize(),t}get context(){return te.getLoggerContext(this.logger)}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.authKeys.init(),await this.requests.init(),await this.pairingTopics.init(),await this.engine.init(),this.logger.info("AuthClient Initialization Success"),this.logger.info({authClient:this})}catch(e){throw this.logger.info("AuthClient Initialization Failure"),this.logger.error(e.message),e}}}const rs=Ge;var qe={exports:{}},z=typeof Reflect=="object"?Reflect:null,pt=z&&typeof z.apply=="function"?z.apply:function(n,e,t){return Function.prototype.apply.call(n,e,t)},ce;z&&typeof z.ownKeys=="function"?ce=z.ownKeys:Object.getOwnPropertySymbols?ce=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:ce=function(n){return Object.getOwnPropertyNames(n)};function ss(n){console&&console.warn&&console.warn(n)}var gt=Number.isNaN||function(n){return n!==n};function g(){g.init.call(this)}qe.exports=g,qe.exports.once=ls,g.EventEmitter=g,g.prototype._events=void 0,g.prototype._eventsCount=0,g.prototype._maxListeners=void 0;var wt=10;function le(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(g,"defaultMaxListeners",{enumerable:!0,get:function(){return wt},set:function(n){if(typeof n!="number"||n<0||gt(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");wt=n}}),g.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},g.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||gt(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function Vt(n){return n._maxListeners===void 0?g.defaultMaxListeners:n._maxListeners}g.prototype.getMaxListeners=function(){return Vt(this)},g.prototype.emit=function(n){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var i=n==="error",r=this._events;if(r!==void 0)i=i&&r.error===void 0;else if(!i)return!1;if(i){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var o=r[n];if(o===void 0)return!1;if(typeof o=="function")pt(o,this,e);else for(var c=o.length,l=Yt(o,c),t=0;t<c;++t)pt(l[t],this,e);return!0};function ft(n,e,t,i){var r,s,a;if(le(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),a=s[e]),a===void 0)a=s[e]=t,++n._eventsCount;else if(typeof a=="function"?a=s[e]=i?[t,a]:[a,t]:i?a.unshift(t):a.push(t),r=Vt(n),r>0&&a.length>r&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=n,o.type=e,o.count=a.length,ss(o)}return n}g.prototype.addListener=function(n,e){return ft(this,n,e,!1)},g.prototype.on=g.prototype.addListener,g.prototype.prependListener=function(n,e){return ft(this,n,e,!0)};function as(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function mt(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},r=as.bind(i);return r.listener=t,i.wrapFn=r,r}g.prototype.once=function(n,e){return le(e),this.on(n,mt(this,n,e)),this},g.prototype.prependOnceListener=function(n,e){return le(e),this.prependListener(n,mt(this,n,e)),this},g.prototype.removeListener=function(n,e){var t,i,r,s,a;if(le(e),i=this._events,i===void 0)return this;if(t=i[n],t===void 0)return this;if(t===e||t.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete i[n],i.removeListener&&this.emit("removeListener",n,t.listener||e));else if(typeof t!="function"){for(r=-1,s=t.length-1;s>=0;s--)if(t[s]===e||t[s].listener===e){a=t[s].listener,r=s;break}if(r<0)return this;r===0?t.shift():os(t,r),t.length===1&&(i[n]=t[0]),i.removeListener!==void 0&&this.emit("removeListener",n,a||e)}return this},g.prototype.off=g.prototype.removeListener,g.prototype.removeAllListeners=function(n){var e,t,i;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[n]),this;if(arguments.length===0){var r=Object.keys(t),s;for(i=0;i<r.length;++i)s=r[i],s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=t[n],typeof e=="function")this.removeListener(n,e);else if(e!==void 0)for(i=e.length-1;i>=0;i--)this.removeListener(n,e[i]);return this};function yt(n,e,t){var i=n._events;if(i===void 0)return[];var r=i[e];return r===void 0?[]:typeof r=="function"?t?[r.listener||r]:[r]:t?cs(r):Yt(r,r.length)}g.prototype.listeners=function(n){return yt(this,n,!0)},g.prototype.rawListeners=function(n){return yt(this,n,!1)},g.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):vt.call(n,e)},g.prototype.listenerCount=vt;function vt(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}g.prototype.eventNames=function(){return this._eventsCount>0?ce(this._events):[]};function Yt(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function os(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function cs(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function ls(n,e){return new Promise(function(t,i){function r(a){n.removeListener(e,s),i(a)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",r),t([].slice.call(arguments))}Ht(n,e,s,{once:!0}),e!=="error"&&hs(n,r,{once:!0})})}function hs(n,e,t){typeof n.on=="function"&&Ht(n,"error",e,t)}function Ht(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function r(s){i.once&&n.removeEventListener(e,r),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}const us="Web3Wallet";class ds{constructor(e){this.opts=e}}class ps{constructor(e){this.client=e}}class gs extends ps{constructor(e){super(e),this.init=async()=>{this.signClient=await ei.init({core:this.client.core,metadata:this.client.metadata}),this.authClient=await rs.init({core:this.client.core,projectId:"",metadata:this.client.metadata}),this.initializeEventListeners()},this.pair=async t=>{await this.client.core.pairing.pair(t)},this.approveSession=async t=>{const{topic:i,acknowledged:r}=await this.signClient.approve({id:t.id,namespaces:t.namespaces});return await r(),this.signClient.session.get(i)},this.rejectSession=async t=>await this.signClient.reject(t),this.updateSession=async t=>await(await this.signClient.update(t)).acknowledged(),this.extendSession=async t=>await(await this.signClient.extend(t)).acknowledged(),this.respondSessionRequest=async t=>await this.signClient.respond(t),this.disconnectSession=async t=>await this.signClient.disconnect(t),this.emitSessionEvent=async t=>await this.signClient.emit(t),this.getActiveSessions=()=>this.signClient.session.getAll().reduce((t,i)=>(t[i.topic]=i,t),{}),this.getPendingSessionProposals=()=>this.signClient.proposal.getAll(),this.getPendingSessionRequests=()=>this.signClient.getPendingSessionRequests(),this.respondAuthRequest=async(t,i)=>await this.authClient.respond(t,i),this.getPendingAuthRequests=()=>this.authClient.requests.getAll().filter(t=>"requester"in t),this.formatMessage=(t,i)=>this.authClient.formatMessage(t,i),this.onSessionRequest=t=>{this.client.events.emit("session_request",t)},this.onSessionProposal=t=>{this.client.events.emit("session_proposal",t)},this.onSessionDelete=t=>{this.client.events.emit("session_delete",t)},this.onAuthRequest=t=>{this.client.events.emit("auth_request",t)},this.initializeEventListeners=()=>{this.signClient.events.on("session_proposal",this.onSessionProposal),this.signClient.events.on("session_request",this.onSessionRequest),this.signClient.events.on("session_delete",this.onSessionDelete),this.authClient.on("auth_request",this.onAuthRequest)},this.signClient={},this.authClient={}}}class Qe extends ds{constructor(e){super(e),this.events=new qe.exports,this.on=(t,i)=>this.events.on(t,i),this.once=(t,i)=>this.events.once(t,i),this.off=(t,i)=>this.events.off(t,i),this.removeListener=(t,i)=>this.events.removeListener(t,i),this.pair=async t=>{try{return await this.engine.pair(t)}catch(i){throw this.logger.error(i.message),i}},this.approveSession=async t=>{try{return await this.engine.approveSession(t)}catch(i){throw this.logger.error(i.message),i}},this.rejectSession=async t=>{try{return await this.engine.rejectSession(t)}catch(i){throw this.logger.error(i.message),i}},this.updateSession=async t=>{try{return await this.engine.updateSession(t)}catch(i){throw this.logger.error(i.message),i}},this.extendSession=async t=>{try{return await this.engine.extendSession(t)}catch(i){throw this.logger.error(i.message),i}},this.respondSessionRequest=async t=>{try{return await this.engine.respondSessionRequest(t)}catch(i){throw this.logger.error(i.message),i}},this.disconnectSession=async t=>{try{return await this.engine.disconnectSession(t)}catch(i){throw this.logger.error(i.message),i}},this.emitSessionEvent=async t=>{try{return await this.engine.emitSessionEvent(t)}catch(i){throw this.logger.error(i.message),i}},this.getActiveSessions=()=>{try{return this.engine.getActiveSessions()}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionProposals=()=>{try{return this.engine.getPendingSessionProposals()}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(t){throw this.logger.error(t.message),t}},this.respondAuthRequest=async(t,i)=>{try{return await this.engine.respondAuthRequest(t,i)}catch(r){throw this.logger.error(r.message),r}},this.getPendingAuthRequests=()=>{try{return this.engine.getPendingAuthRequests()}catch(t){throw this.logger.error(t.message),t}},this.formatMessage=(t,i)=>{try{return this.engine.formatMessage(t,i)}catch(r){throw this.logger.error(r.message),r}},this.metadata=e.metadata,this.name=e.name||us,this.core=e.core,this.logger=this.core.logger,this.engine=new gs(this)}static async init(e){const t=new Qe(e);return await t.initialize(),t}async initialize(){this.logger.trace("Initialized");try{await this.engine.init(),this.logger.info("Web3Wallet Initialization Success")}catch(e){throw this.logger.info("Web3Wallet Initialization Failure"),this.logger.error(e.message),e}}}const ws=Qe;function Jt(){if(we(globalThis.window)&&globalThis.window.ethereum&&window.okxwallet)return window.okxwallet}class ye extends _{get walletName(){return"OKX"}constructor(e){super(ye.id,e),this.isInjected=!!Jt()}async getConnector(){var e,t,i;if(!this.connector)if(this.isInjected){const{OKXConnector:r}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-okx.browser.esm.42ea7b20.js"),["assets/thirdweb-dev-wallets-evm-connectors-okx.browser.esm.42ea7b20.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/errors-3055a99c.browser.esm.77830c12.js","assets/thirdweb-dev-wallets-evm-connectors-injected.browser.esm.60155205.js","assets/url-bc88b2b6.browser.esm.c2527b16.js","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js","assets/index.es.9cbfc799.js","assets/index.33ea6e67.js","assets/constants-1ba9df2b.browser.esm.1400d5f9.js"]);this.OKXConnector=new r({chains:this.chains,connectorStorage:this.walletStorage,options:{shimDisconnect:!0}}),this.connector=new F(this.OKXConnector)}else{const{WalletConnectConnector:r}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-wallet-connect.browser.esm.40f9a8d6.js"),["assets/thirdweb-dev-wallets-evm-connectors-wallet-connect.browser.esm.40f9a8d6.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/url-bc88b2b6.browser.esm.c2527b16.js","assets/errors-3055a99c.browser.esm.77830c12.js"]),s=new r({chains:this.chains,options:{projectId:((e=this.options)==null?void 0:e.projectId)||fe,storage:this.walletStorage,qrcode:(t=this.options)==null?void 0:t.qrcode,dappMetadata:this.dappMetadata,qrModalOptions:(i=this.options)==null?void 0:i.qrModalOptions}});s.getProvider().then(a=>{a.signer.client.on("session_request_sent",()=>{this.emit("wc_session_request_sent")})}),this.walletConnectConnector=s,this.connector=new F(s)}return this.connector}async connectWithQrCode(e){await this.getConnector();const t=this.walletConnectConnector;if(!t)throw new Error("WalletConnect connector not found");(await t.getProvider()).on("display_uri",r=>{e.onQrCodeUri(r)}),this.connect({chainId:e.chainId}).then(e.onConnected)}async switchAccount(){if(!this.OKXConnector)throw new Error("Can not switch Account");await this.OKXConnector.switchAccount()}}f(ye,"id",C.okx);function Zt(){if(we(globalThis.window)&&globalThis.window.ethereum&&window.avalanche)return window.avalanche}class ve extends _{get walletName(){return"Core wallet"}constructor(e){super(ve.id,e),this.isInjected=!!Zt()}async getConnector(){var e,t,i;if(!this.connector)if(this.isInjected){const{CoreWalletConnector:r}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-core-wallet.browser.esm.0983d956.js"),["assets/thirdweb-dev-wallets-evm-connectors-core-wallet.browser.esm.0983d956.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/errors-3055a99c.browser.esm.77830c12.js","assets/thirdweb-dev-wallets-evm-connectors-injected.browser.esm.60155205.js","assets/url-bc88b2b6.browser.esm.c2527b16.js","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js","assets/index.es.9cbfc799.js","assets/index.33ea6e67.js","assets/constants-1ba9df2b.browser.esm.1400d5f9.js"]);this.CoreWalletConnector=new r({chains:this.chains,connectorStorage:this.walletStorage,options:{shimDisconnect:!0}}),this.connector=new F(this.CoreWalletConnector)}else{const{WalletConnectConnector:r}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-wallet-connect.browser.esm.40f9a8d6.js"),["assets/thirdweb-dev-wallets-evm-connectors-wallet-connect.browser.esm.40f9a8d6.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/url-bc88b2b6.browser.esm.c2527b16.js","assets/errors-3055a99c.browser.esm.77830c12.js"]),s=new r({chains:this.chains,options:{projectId:((e=this.options)==null?void 0:e.projectId)||fe,storage:this.walletStorage,qrcode:(t=this.options)==null?void 0:t.qrcode,dappMetadata:this.dappMetadata,qrModalOptions:(i=this.options)==null?void 0:i.qrModalOptions}});s.getProvider().then(a=>{a.signer.client.on("session_request_sent",()=>{this.emit("wc_session_request_sent")})}),this.walletConnectConnector=s,this.connector=new F(s)}return this.connector}async connectWithQrCode(e){await this.getConnector();const t=this.walletConnectConnector;if(!t)throw new Error("WalletConnect connector not found");(await t.getProvider()).on("display_uri",r=>{e.onQrCodeUri(r)}),this.connect({chainId:e.chainId}).then(e.onConnected)}async switchAccount(){if(!this.CoreWalletConnector)throw new Error("Can not switch Account");await this.CoreWalletConnector.switchAccount()}}f(ve,"id",C.coreWallet);function Xt(){if(we(globalThis.window)&&window.coin98)return window.ethereum}class Ie extends _{get walletName(){return"Coin98 wallet"}constructor(e){super(Ie.id,e),this.isInjected=!!Xt()}async getConnector(){var e,t,i;if(!this.connector)if(this.isInjected){const{Coin98Connector:r}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-coin98.browser.esm.369c535d.js"),["assets/thirdweb-dev-wallets-evm-connectors-coin98.browser.esm.369c535d.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/errors-3055a99c.browser.esm.77830c12.js","assets/thirdweb-dev-wallets-evm-connectors-injected.browser.esm.60155205.js","assets/url-bc88b2b6.browser.esm.c2527b16.js","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js","assets/index.es.9cbfc799.js","assets/index.33ea6e67.js","assets/constants-1ba9df2b.browser.esm.1400d5f9.js"]);this.Coin98Connector=new r({chains:this.chains,connectorStorage:this.walletStorage,options:{shimDisconnect:!0}}),this.connector=new F(this.Coin98Connector)}else{const{WalletConnectConnector:r}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-wallet-connect.browser.esm.40f9a8d6.js"),["assets/thirdweb-dev-wallets-evm-connectors-wallet-connect.browser.esm.40f9a8d6.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/url-bc88b2b6.browser.esm.c2527b16.js","assets/errors-3055a99c.browser.esm.77830c12.js"]),s=new r({chains:this.chains,options:{projectId:((e=this.options)==null?void 0:e.projectId)||fe,storage:this.walletStorage,qrcode:(t=this.options)==null?void 0:t.qrcode,dappMetadata:this.dappMetadata,qrModalOptions:(i=this.options)==null?void 0:i.qrModalOptions}});s.getProvider().then(a=>{a.signer.client.on("session_request_sent",()=>{this.emit("wc_session_request_sent")})}),this.walletConnectConnector=s,this.connector=new F(s)}return this.connector}async connectWithQrCode(e){await this.getConnector();const t=this.walletConnectConnector;if(!t)throw new Error("WalletConnect connector not found");(await t.getProvider()).on("display_uri",r=>{e.onQrCodeUri(r)}),this.connect({chainId:e.chainId}).then(e.onConnected)}}f(Ie,"id",C.coin98);class Ee extends St{constructor(e,t){super(),this.config={...e,engineUrl:e.engineUrl.replace(/\/$/,"")},cn(this,"provider",t||null)}async getAddress(){return this.config.backendWalletAddress}async signMessage(e){return(await this.fetch({path:"/backend-wallet/sign-message",method:"POST",body:{message:e}})).result}async signTransaction(e){var r,s,a,o,c,l;const t=await He(e);return(await this.fetch({path:"/backend-wallet/sign-transaction",method:"POST",body:{...t,nonce:(r=t.nonce)==null?void 0:r.toString(),gasLimit:(s=t.gasLimit)==null?void 0:s.toString(),gasPrice:(a=t.gasPrice)==null?void 0:a.toString(),value:(o=t.value)==null?void 0:o.toString(),maxPriorityFeePerGas:(c=t.maxPriorityFeePerGas)==null?void 0:c.toString(),maxFeePerGas:(l=t.maxFeePerGas)==null?void 0:l.toString()}})).result}async sendTransaction(e){if(!this.provider)throw new Error("Sending transactions requires a provider!");const t=(await this.provider.getNetwork()).chainId,i=await He(e),s=(await this.fetch({path:`/backend-wallet/${t}/send-transaction`,method:"POST",body:{toAddress:i.to,data:i.data,value:i.value||"0"}})).result.queueId;return{hash:s,confirmations:0,from:this.config.backendWalletAddress,nonce:0,gasLimit:Je.from(0),value:Je.from(0),data:"",chainId:t,wait:async a=>{if(!this.provider)throw new Error("Sending transactions requires a provider!");for(;;){const{result:o}=await this.fetch({path:`/transaction/status/${s}`,method:"GET"});switch(o.status){case"errored":throw new Error(`Transaction errored with reason: ${o.errorMessage}`);case"cancelled":throw new Error("Transaction execution cancelled.");case"mined":return await this.provider.getTransactionReceipt(o.transactionHash)}await new Promise(c=>setTimeout(c,1e3))}}}}connect(e){return new Ee(this.config,e)}async fetch(e){let{path:t,method:i,body:r}=e;const s=await fetch(`${this.config.engineUrl}${t}`,{method:i,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.accessToken}`,"x-backend-wallet-address":this.config.backendWalletAddress},...r?{body:JSON.stringify(r)}:{}});if(!s.ok)throw new Error(await s.text());return s.json()}}var Me=new WeakMap;class fs extends $e{constructor(e){super(),P(this,Me,{writable:!0,value:void 0}),E(this,Me,new Ee(e))}async getSigner(){return u(this,Me)}}class Y extends _{get walletName(){return"Paper Wallet"}constructor(e){var t,i;super(Y.id,{...e});try{this.chain={...e.chain,rpc:Lt(e.chain,e.clientId)}}catch{this.chain=e.chain}if(e.paperClientId&&e.paperClientId==="uninitialized"){this.paperClientId="00000000-0000-0000-0000-000000000000";return}if(e.advancedOptions&&((t=e.advancedOptions)==null?void 0:t.recoveryShareManagement)==="USER_MANAGED"&&(e.paperClientId&&!this.isClientIdLegacyPaper(e.paperClientId)||!e.paperClientId&&e.clientId&&!this.isClientIdLegacyPaper(e.clientId)))throw new Error('RecoveryShareManagement option "USER_MANAGED" is not supported with thirdweb client ID');if(!e.clientId&&!e.paperClientId)throw new Error("clientId or paperClientId is required");if(e.paperClientId&&!this.isClientIdLegacyPaper(e.paperClientId))throw new Error("paperClientId must be a legacy paper client ID");if(e.clientId&&this.isClientIdLegacyPaper(e.clientId))throw new Error("clientId must be a thirdweb client ID");this.paperClientId=(i=e.paperClientId)!=null?i:e.clientId,this.onAuthSuccess=e.onAuthSuccess}isClientIdLegacyPaper(e){return e.indexOf("-")>0&&e.length===36}async getConnector(){var e,t,i;if(!this.connector){const{PaperWalletConnector:r}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-paper.browser.esm.b791f210.js"),["assets/thirdweb-dev-wallets-evm-connectors-paper.browser.esm.b791f210.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js","assets/index.es.9cbfc799.js","assets/index.33ea6e67.js","assets/errors-3055a99c.browser.esm.77830c12.js","assets/constants-1ba9df2b.browser.esm.1400d5f9.js"]);this.connector=new r({clientId:this.paperClientId,chain:this.chain,chains:this.chains,onAuthSuccess:this.onAuthSuccess,advancedOptions:{recoveryShareManagement:(t=(e=this.options)==null?void 0:e.advancedOptions)==null?void 0:t.recoveryShareManagement},styles:(i=this.options)==null?void 0:i.styles})}return this.connector}getConnectParams(){const e=super.getConnectParams();if(!!e)return typeof e.googleLogin=="object"?{...e,googleLogin:!0}:e}async getEmail(){return(await this.getConnector()).getEmail()}async getPaperSDK(){return(await this.getConnector()).getPaperSDK()}}f(Y,"id",C.paper);f(Y,"meta",{name:"Paper Wallet",iconURL:"ipfs://QmNrLXtPoFrh4yjZbXui39zUMozS1oetpgU8dvZhFAxfRa/paper-logo-icon.svg"});class H extends _{constructor(e){(e==null?void 0:e.chain)&&e.clientId&&(e.chain=se(e.chain,e.clientId)),super(H.id,e),f(this,"name","Blocto")}async initConnector(){var i,r,s;const{BloctoConnector:e}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-blocto.browser.esm.b0f88be3.js"),["assets/thirdweb-dev-wallets-evm-connectors-blocto.browser.esm.b0f88be3.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/url-bc88b2b6.browser.esm.c2527b16.js","assets/errors-3055a99c.browser.esm.77830c12.js","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js"]),t=new e({chains:this.chains,options:{appId:(i=this.options)==null?void 0:i.appId,chainId:(s=(r=this.options)==null?void 0:r.chain)==null?void 0:s.chainId}});return this.connector=new F(t),this.connector}async getConnector(){return this.connector?Promise.resolve(this.connector):await this.initConnector()}}f(H,"id",C.blocto);f(H,"meta",{name:"Blocto",iconURL:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzIyMzNfMjM4NykiPgo8cmVjdCB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHJ4PSIxMiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTMyLjkwMjggMTguMzA2M0MyOC4zOTExIDE4LjMwNjMgMjMuOTg3MyAyMC4wNDU5IDIwLjY5NTIgMjMuMTMxOUMxNy4wODQzIDI2LjUxNzYgMTQuNzk5MiAzMS41MTc3IDEzLjQ4OTMgMzYuMjIxMkMxMi42MzE0IDM5LjI5OTIgMTIuMjAxNiA0Mi40OTE1IDEyLjIwMTYgNDUuNjg1M0MxMi4yMDE2IDQ2LjY1MTEgMTIuMjQxMiA0Ny42MDg5IDEyLjMxNzQgNDguNTU1NkMxMi40MTA5IDQ5LjcwNjkgMTMuNTMyMSA1MC41MDQ2IDE0LjY0ODUgNTAuMjAzM0MxNS42MjIyIDQ5Ljk0MTYgMTYuNjQ2NiA0OS44MDA1IDE3LjcwMjggNDkuODAwNUMxOS44NzIyIDQ5LjgwMDUgMjEuOTA1MiA1MC4zOTA0IDIzLjY0OCA1MS40MjEyQzIzLjY5MDggNTEuNDQ2NiAyMy43MzIgNTEuNDcxOSAyMy43NzQ4IDUxLjQ5NTdDMjYuNjA3MSA1My4xODQ2IDI5Ljk0ODQgNTQuMTEyMyAzMy41MTE3IDUzLjk5MzRDNDIuODA2MiA1My42ODU3IDUwLjM5OSA0Ni4xMjMgNTAuNzQxNiAzNi44MzAxQzUxLjExNTggMjYuNjYzNSA0Mi45ODY5IDE4LjMwNDcgMzIuOTA0NCAxOC4zMDQ3TDMyLjkwMjggMTguMzA2M1pNMzIuOTAyOCA0NC4zMTJDMjguMzk3NSA0NC4zMTIgMjQuNzQ1NCA0MC42NTk5IDI0Ljc0NTQgMzYuMTU2MkMyNC43NDU0IDMxLjY1MjUgMjguMzk3NSAyNy45OTg3IDMyLjkwMjggMjcuOTk4N0MzNy40MDgxIDI3Ljk5ODcgNDEuMDYwMiAzMS42NTA5IDQxLjA2MDIgMzYuMTU2MkM0MS4wNjAyIDQwLjY2MTQgMzcuNDA4MSA0NC4zMTIgMzIuOTAyOCA0NC4zMTJaIiBmaWxsPSIjMTRBQUZGIi8+CjxwYXRoIGQ9Ik0yNS41NjM2IDEyLjY4MjZDMjUuNTYzNiAxNS4wMzQ0IDI0LjMzMTUgMTcuMjE2NCAyMi4zMDggMTguNDE1M0MyMS4wMzc3IDE5LjE2ODYgMTkuODQ2OCAyMC4wNTgyIDE4Ljc2ODQgMjEuMDcxNUMxNi4zNzU1IDIzLjMxMzkgMTQuNTg5OCAyNi4wNjUzIDEzLjI2NzMgMjguNzkyOUMxMy4wMDcyIDI5LjMzMDQgMTIuMiAyOS4xNDAyIDEyLjIgMjguNTQyM1YxMi42ODI2QzEyLjIgOC45OTI0MiAxNS4xOTI0IDYgMTguODgyNiA2QzIyLjU3MjggNiAyNS41NjUyIDguOTkyNDIgMjUuNTY1MiAxMi42ODI2SDI1LjU2MzZaIiBmaWxsPSIjMDA3NUZGIi8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMjIzM18yMzg3Ij4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSJ3aGl0ZSIvPgo8L2NsaXBQYXRoPgo8L2RlZnM+Cjwvc3ZnPgo=",urls:{android:"https://play.google.com/store/apps/details?id=com.portto.blocto",ios:"https://apps.apple.com/app/blocto/id1481181682"}});class k extends _{static async sendVerificationEmail(e){return new k({chain:Mt,clientId:e.clientId}).sendVerificationEmail({email:e.email})}get walletName(){return"Embedded Wallet"}constructor(e){super(k.id,{...e});try{this.chain={...e.chain,rpc:Lt(e.chain,e.clientId)}}catch{this.chain=e.chain}}async getConnector(){var e,t,i;if(!this.connector){const{EmbeddedWalletConnector:r}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-embedded-wallet.browser.esm.17be581c.js"),["assets/thirdweb-dev-wallets-evm-connectors-embedded-wallet.browser.esm.17be581c.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js","assets/index.es.9cbfc799.js","assets/index.33ea6e67.js","assets/errors-3055a99c.browser.esm.77830c12.js","assets/constants-1ba9df2b.browser.esm.1400d5f9.js"]);this.connector=new r({clientId:(t=(e=this.options)==null?void 0:e.clientId)!=null?t:"",chain:this.chain,chains:this.chains,onAuthSuccess:(i=this.options)==null?void 0:i.onAuthSuccess})}return this.connector}autoConnect(e){if(!e)throw new Error("Can't autoconnect embedded wallet");return this.connect(e)}getConnectParams(){const e=super.getConnectParams();if(!!e)return{chainId:e.chainId,authResult:{user:e.authResult.user}}}async getEmail(){return(await this.getConnector()).getEmail()}async getEmbeddedWalletSDK(){return(await this.getConnector()).getEmbeddedWalletSDK()}async getRecoveryInformation(){return(await this.getConnector()).getRecoveryInformation()}async sendVerificationEmail(e){let{email:t}=e;return(await this.getConnector()).sendVerificationEmail({email:t})}async authenticate(e){const i=(await this.getConnector()).authenticate(e);try{await this.walletStorage.setItem(It,e.strategy)}catch{}return i}async getLastUsedAuthStrategy(){try{return await this.walletStorage.getItem(It)}catch{return null}}}f(k,"id",C.embeddedWallet);f(k,"meta",{name:"Embedded Wallet",iconURL:"ipfs://QmNx2evQa6tcQs9VTd3YaDm31ckfStvgRGKFGELahUmrbV/emailIcon.svg"});const It="lastUsedAuthStrategy";var Fe=new WeakMap;class ms extends $e{constructor(e){super(),P(this,Fe,{writable:!0,value:void 0}),E(this,Fe,e)}async getSigner(){return u(this,Fe)}}class be extends _{get walletName(){return"Frame Wallet"}constructor(e){super(be.id,e)}async getConnector(){if(!this.connector){const{FrameConnector:e}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-frame.browser.esm.fcf4285d.js"),["assets/thirdweb-dev-wallets-evm-connectors-frame.browser.esm.fcf4285d.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/url-bc88b2b6.browser.esm.c2527b16.js","assets/errors-3055a99c.browser.esm.77830c12.js","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js"]);this.connector=new F(new e({chains:this.chains,connectorStorage:this.walletStorage,options:{shimDisconnect:!0}}))}return this.connector}}f(be,"id",C.frame);class Ce extends _{get walletName(){return"Injected Wallet"}constructor(e){super(Ce.id,e)}async getConnector(){if(!this.connector){const{InjectedConnector:e}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-injected.browser.esm.60155205.js"),["assets/thirdweb-dev-wallets-evm-connectors-injected.browser.esm.60155205.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/url-bc88b2b6.browser.esm.c2527b16.js","assets/errors-3055a99c.browser.esm.77830c12.js","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js"]);this.connector=new F(new e({chains:this.chains,connectorStorage:this.walletStorage,options:{shimDisconnect:!0}}))}return this.connector}}f(Ce,"id","injected");const ze="localWalletData";var Q=new WeakMap,ie=new WeakSet;class J extends _{get walletName(){return"Local Wallet"}constructor(e){super(J.id,e),Re(this,ie),P(this,Q,{writable:!0,value:void 0}),(e==null?void 0:e.chain)&&e.clientId&&(e.chain=se(e.chain,e.clientId)),this.options=e||{},E(this,Q,(e==null?void 0:e.storage)||Ft(C.localWallet))}async getConnector(){if(!this.connector){const{LocalWalletConnector:e}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-local-wallet.browser.esm.bd67c237.js"),["assets/thirdweb-dev-wallets-evm-connectors-local-wallet.browser.esm.bd67c237.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js"]);if(!this.ethersWallet)throw new Error("wallet is not initialized");const t=(this.options.chain?[...Ze,this.options.chain]:Ze).map(i=>se(i,this.options.clientId));this.connector=new e({chain:this.options.chain||se(Mt,this.options.clientId),ethersWallet:this.ethersWallet,chains:this.chains||t,clientId:this.options.clientId,secretKey:this.options.secretKey})}return this.connector}async loadOrCreate(e){await this.getSavedData(e.storage)?await this.load(e):(await this.generate(),await this.save(e))}async generate(){if(this.ethersWallet)throw new Error("wallet is already initialized");const e=ln(32);return this.ethersWallet=new B(e),this.ethersWallet.address}async import(e){if(this.ethersWallet)throw new Error("wallet is already initialized");if("encryptedJson"in e)return this.ethersWallet=await B.fromEncryptedJson(e.encryptedJson,e.password),this.ethersWallet.address;if("privateKey"in e){if(!e.encryption&&!ke(e.privateKey))throw new Error("invalid private key");const t=await Et(e.encryption)(e.privateKey);if(e.encryption&&(t===""||!ke(t)))throw new Error("invalid password");return this.ethersWallet=new B(t),this.ethersWallet.address}if("mnemonic"in e){if(!e.encryption&&!Xe(e.mnemonic))throw new Error("invalid mnemonic");const t=await Et(e.encryption)(e.mnemonic);if(e.encryption&&(t===""||!Xe(t)))throw new Error("invalid password");return this.ethersWallet=B.fromMnemonic(t),this.ethersWallet.address}throw new Error("invalid import strategy")}async load(e){if(this.ethersWallet)throw new Error("wallet is already initialized");const t=await this.getSavedData(e.storage);if(!t)throw new Error("No Saved wallet found in storage");if(t.strategy!==e.strategy)throw new Error(`Saved wallet data is not ${e.strategy}, it is ${t.strategy}`);if(e.strategy==="encryptedJson")return this.import({encryptedJson:t.data,password:e.password});if(t.isEncrypted&&!e.encryption)throw new Error("Saved wallet data is encrypted, but no password is provided");if(!t.isEncrypted&&e.encryption)throw new Error("Saved wallet data is not encrypted, but encryption config is provided");if(e.strategy==="privateKey")return this.import({privateKey:t.data,encryption:e.encryption});if(e.strategy==="mnemonic")return this.import({mnemonic:t.data,encryption:e.encryption});throw new Error("invalid load strategy")}async save(e){const t=this.ethersWallet;if(!t)throw new Error("Wallet is not initialized");if(e.strategy==="encryptedJson"){const i=await t.encrypt(e.password,{scrypt:{N:1}});await K(this,ie,Te).call(this,{address:t.address,data:i,strategy:"encryptedJson",isEncrypted:!0},e.storage)}if(e.strategy==="privateKey"){const i=await re(e.encryption)(t.privateKey);await K(this,ie,Te).call(this,{address:t.address,data:i,strategy:"privateKey",isEncrypted:!!e.encryption},e.storage)}if(e.strategy==="mnemonic"){if(!t.mnemonic)throw new Error("mnemonic can not be computed if wallet is created from a private key or generated using generate()");const i=await re(e.encryption)(t.mnemonic.phrase);await K(this,ie,Te).call(this,{address:t.address,data:i,strategy:"mnemonic",isEncrypted:!!e.encryption},e.storage)}}async isSaved(){try{const e=await this.getSavedData(),t=await this.getAddress();return(e==null?void 0:e.address)===t}catch{return!1}}async deleteSaved(){await u(this,Q).removeItem(ze)}async export(e){const t=this.ethersWallet;if(!t)throw new Error("Wallet is not initialized");if(e.strategy==="encryptedJson")return t.encrypt(e.password,{scrypt:{N:1<<32}});if(e.strategy==="privateKey")return re(e.encryption)(t.privateKey);if(e.strategy==="mnemonic"){if(!t.mnemonic)throw new Error("mnemonic can not be computed if wallet is created from a private key or generated using generate()");return re(e.encryption)(t.mnemonic.phrase)}throw new Error("Invalid export strategy")}async getSavedData(e){const t=e||u(this,Q);try{const i=await t.getItem(ze);if(!i)return null;const r=JSON.parse(i);return r||null}catch{return null}}async disconnect(){await super.disconnect(),this.ethersWallet=void 0}}async function Te(n,e){await(e||u(this,Q)).setItem(ze,JSON.stringify(n))}f(J,"id",C.localWallet);f(J,"meta",{name:"Local Wallet",iconURL:"ipfs://QmbQzSNGvmNYZzem9jZRuYeLe9K2W4pqbdnVUp7Y6edQ8Y/local-wallet.svg"});async function en(n){return n}function Et(n){return n?e=>(n.decrypt||hn)(e,n.password):en}function re(n){return n?e=>(n.encrypt||un)(e,n.password):en}function ke(n){return!!n.match(/^(0x)?[0-9a-f]{64}$/i)}class Z extends _{get walletName(){return"Magic Link"}constructor(e){super(Z.id,e),this.options=e}async initializeConnector(){const{MagicAuthConnector:e}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-magic.browser.esm.f48c36fa.js"),["assets/thirdweb-dev-wallets-evm-connectors-magic.browser.esm.f48c36fa.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/errors-3055a99c.browser.esm.77830c12.js","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js"]),t=new e({chains:this.chains,options:this.options});return this.magicConnector=t,this.connector=new F(t),this.connector}async getConnector(){return this.connector?this.connector:await this.initializeConnector()}getMagic(){if(!this.magicConnector)throw new Error("Magic connector is not initialized");return this.magicConnector.getMagicSDK()}async autoConnect(e){var r;await this.initializeConnector(),await((r=this.magicConnector)==null?void 0:r.initializeMagicSDK(e));const t=this.getMagic();if(new URL(window.location.href).searchParams.get("magic_credential"))try{this.oAuthRedirectResult=await t.oauth.getRedirectResult()}catch{}if(await t.user.isLoggedIn())return super.autoConnect(e);throw new Error("Magic user is not logged in")}async disconnect(){return this.oAuthRedirectResult=void 0,await this.getMagic().user.logout(),super.disconnect()}async connect(e){if("email"in e&&this.options.emailLogin===!1)throw new Error("Email login is disabled");if("phoneNumber"in e&&this.options.smsLogin===!1)throw new Error("SMS login is disabled");return super.connect(e)}}f(Z,"meta",{iconURL:"ipfs://QmUMBFZGXxBpgDmZzZAHhbcCL5nYvZnVaYLTajsNjLcxMU/1-Icon_Magic_Color.svg",name:"Magic Link"});f(Z,"id",C.magicLink);var Ne=new WeakMap;class ys extends $e{constructor(e,t,i){super(),P(this,Ne,{writable:!0,value:void 0}),E(this,Ne,new B(e,t?dn(t,{secretKey:i}):void 0))}async getSigner(){return u(this,Ne)}}const vs={1:"https://safe-transaction-mainnet.safe.global",5:"https://safe-transaction-goerli.safe.global",10:"https://safe-transaction-optimism.safe.global",56:"https://safe-transaction-bsc.safe.global",100:"https://safe-transaction-gnosis-chain.safe.global",137:"https://safe-transaction-polygon.safe.global",43114:"https://safe-transaction-avalanche.safe.global",42161:"https://safe-transaction-arbitrum.safe.global",42220:"https://safe-transaction-celo.safe.global",84531:"https://safe-transaction-base-testnet.safe.global",1313161554:"https://safe-transaction-aurora.safe.global"},Is=(()=>new Set(Object.keys(vs).map(Number)))();class X extends _{get walletName(){return"Safe Wallet"}constructor(e){super(X.id,{...e})}async getConnector(){if(!this.connector){const{SafeConnector:e}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-safe.browser.esm.b1710272.js"),["assets/thirdweb-dev-wallets-evm-connectors-safe.browser.esm.b1710272.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/index.c7c1986f.js","assets/js.3541f657.js","assets/index.33ea6e67.js","assets/index.es.9cbfc799.js","assets/errors-3055a99c.browser.esm.77830c12.js","assets/normalizeChainId-e4cc0175.browser.esm.042707b7.js","assets/constants-1ba9df2b.browser.esm.1400d5f9.js"]);this.connector=new e}return this.connector}async updateChains(e){}getPersonalWallet(){var e;return(e=this.connector)==null?void 0:e.personalWallet}autoConnect(e){return this.connect(e)}}f(X,"meta",{name:"Safe",iconURL:"ipfs://QmbbyxDDmmLQh8DzzeUR6X6B75bESsNUFmbdvS3ZsQ2pN1/SafeToken.svg"});f(X,"id",C.safe);const Es=Tt;class Ke extends Nt{get walletName(){return"Token Bound Smart Wallet"}constructor(e){super({...e,factoryAddress:e.registryAddress||li}),this.tbaOptions=e}async getConnector(){if(!this.tbaConnector){const{TokenBoundSmartWalletConnector:e}=await I(()=>import("./thirdweb-dev-wallets-evm-connectors-token-bound-smart-wallet.browser.esm.4693ab9e.js"),["assets/thirdweb-dev-wallets-evm-connectors-token-bound-smart-wallet.browser.esm.4693ab9e.js","assets/thirdweb-dev-wallets-evm-connectors-smart-wallet.browser.esm.7d75a129.js","assets/index.f777a6be.js","assets/index.a3eca962.css","assets/index.c7c1986f.js","assets/browser.69111f02.js","assets/url-bc88b2b6.browser.esm.c2527b16.js","assets/constants-1ba9df2b.browser.esm.1400d5f9.js"]);this.tbaConnector=new e(this.tbaOptions)}return this.tbaConnector}}f(Ke,"meta",{name:"Token Bound Smart Wallet",iconURL:"ipfs://QmeAJVqn17aDNQhjEU3kcWVZCFBrfta8LzaDGkS8Egdiyk/smart-wallet.svg"});f(Ke,"id",C.tokenBoundSmartWallet);var bs={Ethereum:"https://ethereum.rpc.thirdweb.com",Goerli:"https://goerli.rpc.thirdweb.com",Mumbai:"https://mumbai.rpc.thirdweb.com",Polygon:"https://polygon.rpc.thirdweb.com",Avalanche:"https://avalanche.rpc.thirdweb.com",Optimism:"https://optimism.rpc.thirdweb.com",OptimismGoerli:"https://optimism-goerli.rpc.thirdweb.com",BSC:"https://binance.rpc.thirdweb.com",BSCTestnet:"https://binance-testnet.rpc.thirdweb.com",ArbitrumOne:"https://arbitrum.rpc.thirdweb.com",ArbitrumGoerli:"https://arbitrum-goerli.rpc.thirdweb.com",Fantom:"https://fantom.rpc.thirdweb.com",FantomTestnet:"https://fantom-testnet.rpc.thirdweb.com",Sepolia:"https://sepolia.rpc.thirdweb.com",AvalancheFuji:"https://avalanche-fuji.rpc.thirdweb.com"},Cs=()=>typeof window<"u"&&window.localStorage.getItem("IS_PAPER_DEV")==="true",As=()=>typeof window<"u"&&window.location.origin.includes("paper.xyz"),_s=()=>{var n;return Cs()?(n=window.localStorage.getItem("PAPER_DEV_URL"))!=null?n:"http://localhost:3000":As()?window.location.origin:"https://withpaper.com"};const Ss="/sdk/2022-08-12/embedded-wallet",ge=()=>`${_s().replace("withpaper.com","embedded-wallet.thirdweb.com")}`,Ls=n=>`thirdwebEwsWalletUserDetails-${n}`,he=n=>`thirdwebEwsWalletUserId-${n}`,Ms="walletToken",ue=n=>`${Ms}-${n}`,tn="a",de=(n,e)=>`${tn}-${n}-${e}`,Fs=n=>`${tn}-${n}`;let Ts=function(n){return n.USER_MANAGED="USER_MANAGED",n.CLOUD_MANAGED="AWS_MANAGED",n}({}),nn=function(n){return n.COGNITO="Cognito",n.GOOGLE="Google",n.EMAIL_OTP="EmailOtp",n.CUSTOM_JWT="CustomJWT",n.FACEBOOK="Facebook",n.APPLE="Apple",n}({}),W=function(n){return n.LOGGED_OUT="Logged Out",n.LOGGED_IN_WALLET_UNINITIALIZED="Logged In, Wallet Uninitialized",n.LOGGED_IN_NEW_DEVICE="Logged In, New Device",n.LOGGED_IN_WALLET_INITIALIZED="Logged In, Wallet Initialized",n}({});const bt=new Map;class Ve{constructor(e){let{clientId:t}=e;this.isSupported=!!window.localStorage,this.clientId=t}async getItem(e){var t;return this.isSupported?window.localStorage.getItem(e):(t=bt.get(e))!=null?t:null}async setItem(e,t){if(this.isSupported)return window.localStorage.setItem(e,t);bt.set(e,t)}async removeItem(e){const t=await this.getItem(e);return this.isSupported&&t?(window.localStorage.removeItem(e),!0):!1}async saveAuthCookie(e){await this.setItem(ue(this.clientId),e)}async getAuthCookie(){return this.getItem(ue(this.clientId))}async removeAuthCookie(){return this.removeItem(ue(this.clientId))}async saveDeviceShare(e,t){await this.saveWalletUserId(t),await this.setItem(de(this.clientId,t),e)}async getDeviceShare(){const e=await this.getWalletUserId();return e?this.getItem(de(this.clientId,e)):null}async removeDeviceShare(){const e=await this.getWalletUserId();return e?this.removeItem(de(this.clientId,e)):!1}async getWalletUserId(){return this.getItem(he(this.clientId))}async saveWalletUserId(e){await this.setItem(he(this.clientId),e)}async removeWalletUserId(){return this.removeItem(he(this.clientId))}}function De(n){return new Promise(e=>{setTimeout(e,n*1e3)})}const Ns={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"},Oe=new Map;class Ds{constructor(e){let{link:t,iframeId:i,container:r=document.body,iframeStyles:s,onIframeInitialize:a}=e;f(this,"POLLING_INTERVAL_SECONDS",1.4),this.iframeBaseUrl=ge();let o=document.getElementById(i);const c=new URL(t),l="2.1.9";if(c.searchParams.set("sdkVersion",l),!o||o.src!==c.href){if(!o){o=document.createElement("iframe");const p={...Ns,...s};Object.assign(o.style,p),o.setAttribute("id",i),o.setAttribute("fetchpriority","high"),r.appendChild(o)}o.src=c.href,o.setAttribute("data-version",l);const h=p=>{if(p.data.eventType==="ewsIframeLoaded"){if(window.removeEventListener("message",h),!o){console.warn("thirdweb Iframe not found");return}this.onIframeLoadHandler(o,a)()}};window.addEventListener("message",h)}this.iframe=o}async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{await new Promise(async(r,s)=>{var c;const a=new MessageChannel;a.port1.onmessage=l=>{const{data:h}=l;return a.port1.close(),h.success?(Oe.set(e.src,!0),t&&t(),r(!0)):s(new Error(h.error))};const o="initIframe";(c=e==null?void 0:e.contentWindow)==null||c.postMessage({eventType:o,data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2])})}}async call(e){let{procedureName:t,params:i,showIframe:r=!1}=e;for(;!Oe.get(this.iframe.src);)await De(this.POLLING_INTERVAL_SECONDS);return r&&(this.iframe.style.display="block",await De(.005)),new Promise((a,o)=>{var l;const c=new MessageChannel;c.port1.onmessage=async h=>{const{data:p}=h;c.port1.close(),r&&(await De(.1),this.iframe.style.display="none"),p.success?a(p.data):o(new Error(p.error))},(l=this.iframe.contentWindow)==null||l.postMessage({eventType:t,data:i},this.iframeBaseUrl,[c.port2])})}destroy(){Oe.delete(this.iframe.src)}}class Os extends Ds{constructor(e){let{clientId:t,customizationOptions:i}=e;super({iframeId:xs,link:Ps({clientId:t,path:Ss,queryParams:i}).href,container:document.body}),this.clientId=t}async onIframeLoadedInitVariables(){const e=new Ve({clientId:this.clientId});return{authCookie:await e.getAuthCookie(),deviceShareStored:await e.getDeviceShare(),walletUserId:await e.getWalletUserId(),clientId:this.clientId}}}function Ps(n){var s;let{clientId:e,path:t,queryParams:i}=n;const r=new URL(`${t}`,ge());if(i)for(const a of Object.keys(i))r.searchParams.set(a,((s=i[a])==null?void 0:s.toString())||"");return r.searchParams.set("clientId",e),r}const xs="thirdweb-embedded-wallet-iframe";class js{constructor(e){let{querier:t,preLogin:i,postLogin:r,clientId:s}=e;this.LoginQuerier=t,this.preLogin=i,this.postLogin=r,this.clientId=s}async sendEmailLoginOtp(e){let{email:t}=e;return await this.preLogin(),await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:t}})}}class Rs extends js{constructor(){super(...arguments),f(this,"closeWindow",e=>{let{isWindowOpenedByFn:t,win:i,closeOpenedWindow:r}=e;t?i==null||i.close():i&&r?r(i):i&&i.close()})}async getOauthLoginUrl(e){return await this.LoginQuerier.call({procedureName:"getHeadlessOauthLoginLink",params:{authProvider:e}})}async loginWithModal(){await this.preLogin();const e=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0});return this.postLogin(e)}async loginWithEmailOtp(e){let{email:t}=e;await this.preLogin();const i=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:t},showIframe:!0});return this.postLogin(i)}getOauthPopUpSizing(e){switch(e){case nn.FACEBOOK:return"width=715, height=555";default:return"width=350, height=500"}}async loginWithOauth(e){let t=e==null?void 0:e.openedWindow,i=!1;if(t||(t=window.open("","Login",this.getOauthPopUpSizing(e.oauthProvider)),i=!0),!t)throw new Error("Something went wrong opening pop-up");const[{loginLink:r}]=await Promise.all([this.getOauthLoginUrl(e.oauthProvider),this.preLogin()]);t.location.href=r;const s=await new Promise((a,o)=>{const c=window.setInterval(async()=>{!t||t.closed&&(clearInterval(c),window.removeEventListener("message",l),o(new Error("User closed login window")))},1e3),l=async h=>{if(h.origin===ge()){if(typeof h.data!="object"){o(new Error("Invalid event data"));return}switch(h.data.eventType){case"userLoginSuccess":{window.removeEventListener("message",l),clearInterval(c),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:e==null?void 0:e.closeOpenedWindow}),h.data.authResult&&a(h.data.authResult);break}case"userLoginFailed":{window.removeEventListener("message",l),clearInterval(c),this.closeWindow({isWindowOpenedByFn:i,win:t,closeOpenedWindow:e==null?void 0:e.closeOpenedWindow}),o(new Error(h.data.error));break}case"injectDeveloperClientId":{t==null||t.postMessage({eventType:"injectDeveloperClientIdResult",developerClientId:this.clientId,authOption:e.oauthProvider},ge());break}}}};window.addEventListener("message",l)});return this.postLogin({storedToken:{...s.storedToken,shouldStoreCookieString:!0},walletDetails:{...s.walletDetails,isIframeStorageEnabled:!1}})}async loginWithCustomJwt(e){let{encryptionKey:t,jwt:i}=e;const r=await this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:t,jwt:i}});return this.postLogin(r)}async verifyEmailLoginOtp(e){let{email:t,otp:i,recoveryCode:r}=e;const s=await this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:t,otp:i,recoveryCode:r}});return this.postLogin(s)}}class Ws{constructor(e){let{clientId:t,querier:i,onAuthSuccess:r}=e;this.clientId=t,this.AuthQuerier=i,this.localStorage=new Ve({clientId:t}),this.onAuthSuccess=r,this.BaseLogin=new Rs({postLogin:async s=>this.postLogin(s),preLogin:async()=>{await this.preLogin()},querier:i,clientId:t})}async preLogin(){await this.logout()}async postLogin(e){let{storedToken:t,walletDetails:i}=e;return t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString),await this.onAuthSuccess({storedToken:t,walletDetails:i})}async loginWithModal(){return await this.preLogin(),this.BaseLogin.loginWithModal()}async loginWithEmailOtp(e){return this.BaseLogin.loginWithEmailOtp(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async loginWithOauth(e){return this.BaseLogin.loginWithOauth(e)}async sendEmailLoginOtp(e){let{email:t}=e;return this.BaseLogin.sendEmailLoginOtp({email:t})}async verifyEmailLoginOtp(e){return this.BaseLogin.verifyEmailLoginOtp(e)}async logout(){const{success:e}=await this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=await this.localStorage.removeAuthCookie(),i=await this.localStorage.removeWalletUserId();return{success:e||t||i}}}class Ye extends St{constructor(e){var s;let{provider:t,clientId:i,querier:r}=e;super(),f(this,"DEFAULT_ETHEREUM_CHAIN_ID",5),this.clientId=i,this.querier=r,this.endpoint=(s=t.connection)==null?void 0:s.url,gn.defineReadOnly(this,"provider",t)}async getAddress(){const{address:e}=await this.querier.call({procedureName:"getAddress",params:void 0});return e}async signMessage(e){var i,r,s;const{signedMessage:t}=await this.querier.call({procedureName:"signMessage",params:{message:e,chainId:(s=(r=await((i=this.provider)==null?void 0:i.getNetwork()))==null?void 0:r.chainId)!=null?s:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return t}async signTransaction(e){var i,r,s;const{signedTransaction:t}=await this.querier.call({procedureName:"signTransaction",params:{transaction:e,chainId:(s=(r=await((i=this.provider)==null?void 0:i.getNetwork()))==null?void 0:r.chainId)!=null?s:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return t}async _signTypedData(e,t,i){var s,a,o;const{signedTypedData:r}=await this.querier.call({procedureName:"signTypedDataV4",params:{domain:e,types:t,message:i,chainId:(o=(a=await((s=this.provider)==null?void 0:s.getNetwork()))==null?void 0:a.chainId)!=null?o:this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return r}connect(e){return new Ye({clientId:this.clientId,provider:e,querier:this.querier})}}class Us{constructor(e){let{clientId:t,chain:i,querier:r}=e;this.clientId=t,this.chain=i,this.walletManagerQuerier=r,this.localStorage=new Ve({clientId:t})}async postWalletSetUp(e){let{deviceShareStored:t,walletAddress:i,isIframeStorageEnabled:r,walletUserId:s}=e;return r||await this.localStorage.saveDeviceShare(t,s),{walletAddress:i}}async getUserWalletStatus(){const e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===W.LOGGED_IN_WALLET_INITIALIZED?{status:W.LOGGED_IN_WALLET_INITIALIZED,...e.user,wallet:this}:e.status===W.LOGGED_IN_NEW_DEVICE?{status:W.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:e.status===W.LOGGED_IN_WALLET_UNINITIALIZED?{status:W.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async setChain(e){let{chain:t}=e;this.chain=t}async getEthersJsSigner(e){var i;return new Ye({clientId:this.clientId,provider:pn((i=e==null?void 0:e.rpcEndpoint)!=null?i:bs[this.chain]),querier:this.walletManagerQuerier})}}class qs{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&e.length===36}constructor(e){let{clientId:t,chain:i,styles:r,onAuthSuccess:s}=e;if(this.isClientIdLegacyPaper(t))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");this.clientId=t,this.querier=new Os({clientId:t,customizationOptions:r}),this.wallet=new Us({clientId:t,chain:i,querier:this.querier}),this.auth=new Ws({clientId:t,querier:this.querier,onAuthSuccess:async a=>(s==null||s(a),await this.wallet.postWalletSetUp({...a.walletDetails,walletUserId:a.storedToken.authDetails.userWalletId}),await this.querier.call({procedureName:"initIframe",params:{deviceShareStored:a.walletDetails.deviceShareStored,clientId:this.clientId,walletUserId:a.storedToken.authDetails.userWalletId,authCookie:a.storedToken.cookieString}}),{user:{status:W.LOGGED_IN_WALLET_INITIALIZED,authDetails:a.storedToken.authDetails,wallet:this.wallet,walletAddress:a.walletDetails.walletAddress}})})}async getUser(){return this.wallet.getUserWalletStatus()}}const Pe="__TW__";class rn{constructor(e){this.name=e}getItem(e){return localStorage.getItem(`${Pe}/${this.name}/${e}`)}setItem(e,t){return localStorage.setItem(`${Pe}/${this.name}/${e}`,t)}removeItem(e){return localStorage.removeItem(`${Pe}/${this.name}/${e}`)}}function zs(n){return new rn(n)}class ks{async getItem(){const e=await navigator.credentials.get({password:!0,unmediated:!0});return e&&"password"in e?e.password:null}async setItem(e,t){const i=await navigator.credentials.create({password:{id:e,name:e,password:t}});if(!i)throw new Error("Credential not created");await navigator.credentials.store(i)}async removeItem(){await navigator.credentials.get({password:!0,unmediated:!0})&&await navigator.credentials.preventSilentAccess()}}class sn extends wn{constructor(e){super(),this.wallet=e}}var xe=new WeakMap,y=new WeakMap,M=new WeakMap,je=new WeakMap,U=new WeakMap,q=new WeakMap,Ct=new WeakSet,At=new WeakSet;class $s extends sn{constructor(e,t){super(t),Re(this,At),Re(this,Ct),P(this,xe,{writable:!0,value:void 0}),P(this,y,{writable:!0,value:void 0}),P(this,M,{writable:!0,value:void 0}),P(this,je,{writable:!0,value:void 0}),P(this,U,{writable:!0,value:void 0}),P(this,q,{writable:!0,value:void 0});const i={walletConnectWalletMetadata:{name:"Thirdweb Smart Wallet",description:"Thirdweb Smart Wallet",url:"https://thirdweb.com",icons:["https://thirdweb.com/favicon.ico"]},walletConnectV2ProjectId:fe,walletConnectV2RelayUrl:fn,...(e==null?void 0:e.walletConnectReceiver)===!0?{}:e==null?void 0:e.walletConnectReceiver};E(this,je,i.walletConnectWalletMetadata),E(this,xe,new Dt({projectId:i.walletConnectV2ProjectId,relayUrl:i.walletConnectV2RelayUrl}))}async init(){E(this,y,await ws.init({core:u(this,xe),metadata:u(this,je)}));const e=u(this,y).getActiveSessions(),t=Object.keys(e);t[0]&&E(this,M,e[t[0]]),K(this,Ct,Bs).call(this)}async connectApp(e){if(!u(this,y))throw new Error("Please, init the wallet before connecting an app.");await u(this,y).core.pairing.pair({uri:e})}async approveSession(){var o;if(!u(this,y))throw new Error("Please, init the wallet before making session requests.");if(!u(this,U))throw new Error("Please, pass a valid proposal.");const e=await this.wallet.getAddress(),{id:t,params:i}=u(this,U),{requiredNamespaces:r,relays:s}=i,a={};Object.keys(r).forEach(c=>{var p;const l=[],h=r[c];h&&((p=h.chains)==null||p.map(w=>{l.push(`${w}:${e}`)}),a[c]={accounts:l,methods:h.methods,events:h.events})}),E(this,M,await u(this,y).approveSession({id:t,relayProtocol:(o=s[0])==null?void 0:o.protocol,namespaces:a})),this.emit("session_approved")}async rejectSession(){if(!u(this,y))throw new Error("Please, init the wallet before making session requests.");if(!u(this,U))throw new Error("Please, pass a valid proposal.");const{id:e}=u(this,U);await u(this,y).rejectSession({id:e,reason:{message:"User rejected methods.",code:5002}})}async approveEIP155Request(){var a,o;if(!u(this,q))return;const{topic:e,params:t,id:i}=u(this,q),{request:r}=t;let s;switch(r.method){case j.PERSONAL_SIGN:case j.ETH_SIGN:const c=K(this,At,Gs).call(this,r.params),l=await this.wallet.signMessage(c||"");s=ae(i,l);break;case j.ETH_SEND_TRANSACTION:const h=await this.wallet.getSigner(),p=r.params[0],w=await h.sendTransaction(p),{transactionHash:T}=await w.wait();s=ae(i,T);break;case j.ETH_SIGN_TRANSACTION:const d=await this.wallet.getSigner(),m=r.params[0],S=await d.signTransaction(m);s=ae(i,S);break;default:const b={id:i,jsonrpc:"2.0",error:{message:"Invalid event.",code:1002}};return(a=u(this,y))==null?void 0:a.respondSessionRequest({topic:e,response:b})}return(o=u(this,y))==null?void 0:o.respondSessionRequest({topic:e,response:s})}async rejectEIP155Request(){var r;if(!u(this,q))return;const{topic:e,id:t}=u(this,q),i={id:t,jsonrpc:"2.0",error:{message:"User rejected methods.",code:5002}};return(r=u(this,y))==null?void 0:r.respondSessionRequest({topic:e,response:i})}getActiveSessions(){if(!u(this,y))throw new Error("Please, init the wallet before getting sessions.");const e=u(this,y).getActiveSessions(),t=Object.keys(e);if(!e||t.length===0)return[];const i=[];for(const r of t){const s=e[r];if(s){const a=s.topic,o=s.peer.metadata;i.push({topic:a,peer:{metadata:o}})}}return i}disconnectSession(){var t;if(!u(this,y))throw new Error("Please, init the wallet before disconnecting sessions.");if(!u(this,M))return Promise.resolve();const e={topic:u(this,M).topic,reason:{message:"User disconnected.",code:6e3}};return(t=u(this,y))==null?void 0:t.disconnectSession(e)}}function Bs(){if(!u(this,y))throw new Error("Please, init the wallet before making session requests.");u(this,y).on("session_proposal",n=>{E(this,U,n),this.emit("session_proposal",{proposer:{metadata:n.params.proposer.metadata}})}),u(this,y).on("session_delete",n=>{E(this,M,void 0),E(this,U,void 0),this.emit("session_delete",{topic:n.topic})}),u(this,y).on("session_request",async n=>{if(!u(this,M))return;const{params:e}=n,{request:t}=e,{params:i}=t;switch(t.method){case j.ETH_SIGN:case j.PERSONAL_SIGN:E(this,q,n);const r=i[0],s=new TextDecoder().decode(mn(r)),a=[...i];a[0]=s,this.emit("session_request",{topic:u(this,M).topic,params:a,peer:{metadata:u(this,M).peer.metadata},method:t.method});return;case j.ETH_SEND_TRANSACTION:case j.ETH_SIGN_TRANSACTION:E(this,q,n),this.emit("session_request",{topic:u(this,M).topic,params:n.params.request.params,peer:{metadata:u(this,M).peer.metadata},method:t.method});return;default:throw new Error(`WCV2.Method not supported: ${t.method}`)}})}function Gs(n){const e=n.filter(t=>!yn(t))[0]||"";return vn(e)?In(e):e}const Zs=Object.freeze(Object.defineProperty({__proto__:null,CredentialsStorage:ks,LocalStorage:rn,WalletConnectHandler:sn,WalletConnectV2Handler:$s,createLocalStorage:zs,EIP155_SIGNING_METHODS:j,AbstractClientWallet:_,AsyncLocalStorage:En,DEFAULT_DAPP_META:bn,createAsyncLocalStorage:Ft,isWalletAnalyticsEnabled:Cn,setWalletAnalyticsEnabled:An,walletIds:C,WagmiConnector:ni,AddChainError:ii,ChainNotConfiguredError:ri,ProviderRpcError:si,SwitchChainError:ai,UserRejectedRequestError:oi,normalizeChainId:ci,Connector:_n,WagmiAdapter:F,OKXWallet:ye,getInjectedOKXProvider:Jt,CoreWallet:ve,getInjectedCoreWalletProvider:Zt,Coin98Wallet:Ie,getInjectedCoin98Provider:Xt,getInjectedMetamaskProvider:Sn,getInjectedPhantomProvider:Ln,getInjectedRainbowProvider:Mn,getInjectedCoinbaseProvider:Fn,assertWindowEthereum:we,EngineSigner:Ee,EngineWallet:fs,PaperWallet:Y,BloctoWallet:H,CoinbaseWallet:Tn,EmbeddedWallet:k,EthersWallet:ms,FrameWallet:be,InjectedWallet:Ce,LocalWallet:J,isValidPrivateKey:ke,SignerWallet:Nn,MagicLink:Z,MetaMaskWallet:Dn,PhantomWallet:On,PrivateKeyWallet:ys,RainbowWallet:Pn,SafeSupportedChainsSet:Is,SafeWallet:X,SmartWallet:Nt,getAllSigners:xn,getAllSmartWallets:jn,getSmartWalletAddress:Rn,isSmartWalletDeployed:Wn,TrustWallet:Un,WalletConnect:Tt,WalletConnectV1:Es,ZerionWallet:qn,TokenBoundSmartWallet:Ke,AUTH_TOKEN_LOCAL_STORAGE_NAME:ue,AuthProvider:nn,DEVICE_SHARE_LOCAL_STORAGE_NAME:de,DEVICE_SHARE_LOCAL_STORAGE_NAME_DEPRECATED:Fs,EmbeddedWalletSdk:qs,RecoveryShareManagement:Ts,UserWalletStatus:W,WALLET_USER_DETAILS_LOCAL_STORAGE_NAME:Ls,WALLET_USER_ID_LOCAL_STORAGE_NAME:he},Symbol.toStringTag,{value:"Module"}));export{nn as A,vs as C,qs as E,W as U,Zt as a,Xt as b,bs as e,Jt as g,_s as i,Zs as t};
